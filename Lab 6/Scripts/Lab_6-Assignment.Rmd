---
title: "Biol 3872 Lab6-Assignment"
output: html_document
date: "`r Sys.Date()`"
author: "Ella Cavicchi"
student_id: "B00898234"
editor_options: 
  chunk_output_type: console
---

\
**BEFORE STARTING:**\
1. Include your name (as shown in Brightspace) in the `author` section above as text (e.g., "Liam MacNeil") and Banner ID ("B00123456") in `student_id`.\
2. Install and load the packages required to run your code chunks/

Assignments will largely be evaluated based on your code chunk answers. If they are incomplete or formatted incorrectly (e.g., code chunks don't run), no marks will be awarded. I recommend experimenting with solving these answers in a separate script/markdown document and reporting your answers with minimal script.

::: {style="background-color: #44AA99; padding: padding: 5px; border-radius: 2px;"}
## Task 1 {2 points}

A)  Convert and if needed, correct the character strings to dates 1-5 in unambiguous formats. Store these as variables with the given names.

B)  Convert and if needed, correct the character strings to datetimes 1-3 in unambiguous formats. Store these as variables with the given names. Give all datetimes in Atlantic Standard Time (AST). Check `?OlsonNames`.

```{r}
# YOUR CODE HERE

# A)
# Roald Amundsen reaches the South Pole
#date1 <- "Dec/14/1911"
date1 <- as.Date("Dec/14/1911", format= "%b/%d/%Y")

# Alexander Graham Bell and Thomas Watson exchange the first telephone call
#date2 <- "January 25, 1915"
date2 <- as.Date("January-25-1915", format= "%B-%d-%Y")

# Sputnik is launched into orbit
#date3 <- "Oct 4 1957"
date3 <- as.Date("Oct/4/1957", format="%b/%d/%Y")

# The first Woodstock festival begins
#date4 <- "Augus 16 69"
date4 <- as.Date("Aug/16/69", format="%b/%d/%y")

# The first Blackberry mobile device is released by Research In Motion
#date5 <- "19/99/January"
date5 <- as.Date("19/99/January", format="%d/%y/%B")


# B)


# The estimated minute (Pacific Standard Time) Sidney Crosby scored the overtime goal to win gold in 2010 Olympics
#datetime1 <- "February 28th, 2010 2:38PM"

datetime1 <- as.POSIXct("February-28-2010 2:38pm", format="%B-%d-%Y %I:%M%p", tz="Canada/Pacific")
datetime1 <- with_tz(datetime1, "Canada/Atlantic")
datetime1

# The timestamp of the first observations detecting gravitational waves. These were produced by the whirling merger of two black holes, generating ripples in space-time confirming Einstein's prediction from general relativity (reported in UTC; observed first at 05:50:45 in Louisiana within Eastern Standard Time)
#datetime2 <- "Sept/14/2015 09:50:45"

datetime2 <- as.POSIXct("Sep-14-2015 09:50:45", format="%b-%d-%Y %I:%M:%S", tz="EST")  
datetime2 <- with_tz(datetime2, "UTC")
datetime2

# The beginning minute a total eclipse* was visible over large sections of Nova Scotia
# * These occur every ~18 months, but in any one (inhabited) place, may not occur for centuries.
#datetime3 <- "04-8-2024 16:39"

datetime3 <- as.POSIXct("04-8-2024 16:39", format= "%m-%d-%Y %H:%M", tz= "Canada/Atlantic")
datetime3
```
:::

\

::: {style="background-color: #44AA99; padding: padding: 5px; border-radius: 2px;"}
## Task 2 {3 points}

A)  Using the Bedford Basin data (`Bedford_ts`) and your skills indexing data, extract all the rows where `year` equals 2016, store this data in a variable called `ts_2016`. **Do you need to load certain packages to complete this?**

B)  Convert the `month` column to full month names in column called `month_full`.

C)  Summarize microbial richness (median) by each year and each month, then plot it using `ggplot` with the x-axis showing full month names (**arranged by calender order**), coloring points by `Year`. Store this plot in a plot object called `monthly_richness`.

**NOT MARKED**: Make this plot pretty: e.g., modify x-axis labels to be readable, edit `Year` to be discrete, apply a nice color palette, and customize in other ways that improve plot quality.

```{r}
library(tidyverse)

Bedford_ts <- read.csv("../Data/BedfordBasin_ts.csv") %>%
  mutate(Year = year(Date),
         Month = month(Date))

# YOUR CODE HERE
# A)
ts_2016 <- Bedford_ts %>% filter(Year==2016)
ts_2016

# B)
Bedford_ts$month_full<-month.name[Bedford_ts$Month]


# C)
monthly_richness <- Bedford_ts%>% 
  group_by(month_full, Year) %>% 
  summarise(median=median(Richness)) %>% 
  mutate(month_full = factor(month_full, levels = month.name))%>%
  mutate(Year=factor(Year)) %>% 
  ggplot(aes(x=month_full, y=median, color = Year))+
  geom_point()+
  scale_color_manual(values= c("lightskyblue", "steelblue4", "coral2", "indianred3"))+
  theme_minimal()+
  theme(axis.text.x = element_text(angle = 45, hjust = 1))+
  labs(x="Month", y="Median Richness")
monthly_richness

```
:::

\

::: {style="background-color: #44AA99; padding: padding: 5px; border-radius: 2px;"}
## Task 3 {3 points}

A)  Take the sequences of `day`, `month`, `year`, `hour`, `min`, and `secs` and combine them into a single vector of unambiguous datetimes named `combined_datetime`.

B)  Search `OlsonNames` to find the time zone for Stockholm (Sweden) and assign this to datetimes in a new object called `combined_datetime_stock`.

C)  Convert these times to the Atlantic Canada timezone (AST) and store named these datetimes in `combined_datetime_NS`.

```{r}
day <- seq(1,30, 1)
month <- rep(seq(1, 10, 1), 3)
year <- 1978:2007
hour <- rep(11:20, 3)
min <- 15:44
sec <- 4:33

# A)
combined_datetime <- make_datetime(year, month, day, hour, min, sec)

# B)
combined_datetime_stock <- with_tz(combined_datetime, "CET")

# C)
combined_datetime_NS <- with_tz(combined_datetime, "Canada/Atlantic")

```
:::

\

::: {style="background-color: #44AA99; padding: padding: 5px; border-radius: 2px;"}
## Task 4 {3 points}

A)  Convert vector of `dates` to a date object called `dates_format`.

B)  Calculate the difference between each date in sequence (date 1 to date 2, date 2 to date 3, etc.) and store this as a **vector** called `dfftime_v1`. This can be done manually, you can also check functions from `lubridate` (`?diff`), but remember to convert to a vector.

C)  Index `dates_format` to remove all dates which are after the date when gravitational waves were first measured (see Q1). Store this as a vector called `pre_Einstein`.

```{r}
dates <- c("1974-01-01","1981-09-04","1993-05-18","2004-12-11","2015-09-14","2023-01-13")

# YOUR CODE HERE
# A)
dates_format <- as.Date(dates, format = "%Y-%m-%d")

# B)
dfftime_v1 <- as.vector(diff(dates_format))


# C)
pre_Einstein <- dates_format[dates_format<datetime2]

```
:::

\

::: {style="background-color: #44AA99; padding: padding: 5px; border-radius: 2px;"}
## Task 5 {2 points}

A)  Using the Bedford Basin data (`Bedford_ts`), create a `for()` loop or use an `*apply` that calculates the weekly median microbial richness and store it in a variable called `weekly_median`.

B)  Create a `ggplot` object called `Richness_weekly` which plots raw richness (y-axis) against weeks (x-axis). Color points based on their `month_full` name (ordered by calender). Overlay `weekly_median` into this plot with a unique `geom_point` layer.\

```{r}
# YOUR CODE HERE
# A)
Bedford_ts$Date <- as.Date(Bedford_ts$Date, format = "%Y-%m-%d")
class(Bedford_ts$Date)

Bedford_ts$week <- format(Bedford_ts$Date, "%U")

#forloop 
unique_weeks <- sort(unique(Bedford_ts$week))
weekly_median <- c()

for (i in unique_weeks) {
  
  weekly_values <- Bedford_ts$Richness[Bedford_ts$week == i]
  weekly_median[i] <- median(weekly_values)
}
weekly_median

# B)
weekly_median <- as.data.frame(weekly_median)
weekly_median$week_number <- c(1:51)

Richness_weekly <- Bedford_ts %>%
  mutate(month_full = factor(month_full, levels = month.name)) %>%
  ggplot(aes(x=week, y=Richness, color=month_full))+
  geom_point()+
  geom_point(data=weekly_median, 
             aes(x=week_number, y=weekly_median), 
             color="black")
Richness_weekly

```
:::

Clear your environment (broom) and run your entire script to ensure everything has been defined properly!

Be sure to submit this `markdown` file to the relevant Brightspace submission box.
